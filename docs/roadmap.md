# üó∫Ô∏è Roadmap - MeAjudaAi

Este documento consolida o planejamento estrat√©gico e t√°tico da plataforma MeAjudaAi, definindo fases de implementa√ß√£o, m√≥dulos priorit√°rios e funcionalidades futuras.

---

## üìñ Vis√£o Geral

O roadmap est√° organizado em **tr√™s fases principais** para entrega incremental de valor:

1. **Fase 1: Funda√ß√£o (MVP Core)** - Registro de prestadores, busca geolocalizada, cat√°logo de servi√ßos
2. **Fase 2: Qualidade e Monetiza√ß√£o** - Sistema de avalia√ß√µes, assinaturas premium, verifica√ß√£o automatizada
3. **Fase 3: Experi√™ncia e Engajamento** - Agendamentos, comunica√ß√µes, analytics avan√ßado

A implementa√ß√£o seguir√° os princ√≠pios arquiteturais definidos em `architecture.md`: **Modular Monolith**, **DDD**, **CQRS**, e **isolamento schema-per-module**.

---

## üéØ Fase 1: Funda√ß√£o (MVP Core)

### Objetivo
Estabelecer as capacidades essenciais da plataforma: registro multi-etapas de prestadores com verifica√ß√£o, busca geolocalizada e cat√°logo de servi√ßos.

### 1.1. ‚úÖ M√≥dulo Users (Conclu√≠do)
**Status**: Implementado e em produ√ß√£o

**Funcionalidades Entregues**:
- ‚úÖ Registro e autentica√ß√£o via Keycloak (OIDC)
- ‚úÖ Gest√£o de perfil b√°sica
- ‚úÖ Sistema de roles e permiss√µes
- ‚úÖ Health checks e monitoramento
- ‚úÖ API versionada com documenta√ß√£o OpenAPI

---

### 1.2. ‚úÖ M√≥dulo Providers (Conclu√≠do)

**Status**: Implementado e em produ√ß√£o

**Funcionalidades Entregues**:
- ‚úÖ Provider aggregate com estados de registro (`EProviderStatus`: Draft, PendingVerification, Active, Suspended, Rejected)
- ‚úÖ M√∫ltiplos tipos de prestador (Individual, Company)
- ‚úÖ Verifica√ß√£o de documentos integrada com m√≥dulo Documents
- ‚úÖ BusinessProfile com informa√ß√µes de contato e identidade empresarial
- ‚úÖ Gest√£o de qualifica√ß√µes e certifica√ß√µes
- ‚úÖ Domain Events (`ProviderRegistered`, `ProviderVerified`, `ProviderRejected`)
- ‚úÖ API p√∫blica (IProvidersModuleApi) para comunica√ß√£o inter-m√≥dulos
- ‚úÖ Queries por documento, cidade, estado, tipo e status de verifica√ß√£o
- ‚úÖ Soft delete e auditoria completa

---

### 1.3. ‚úÖ M√≥dulo Documents (Conclu√≠do)

**Status**: Implementado e em produ√ß√£o

**Funcionalidades Entregues**:
- ‚úÖ Upload seguro de documentos via Azure Blob Storage
- ‚úÖ Tipos de documento suportados: IdentityDocument, ProofOfResidence, ProfessionalLicense, BusinessLicense
- ‚úÖ Workflow de verifica√ß√£o com estados (`EDocumentStatus`: Uploaded, PendingVerification, Verified, Rejected, Failed)
- ‚úÖ Integra√ß√£o completa com m√≥dulo Providers
- ‚úÖ Domain Events (`DocumentUploaded`, `DocumentVerified`, `DocumentRejected`, `DocumentFailed`)
- ‚úÖ API p√∫blica (IDocumentsModuleApi) para queries de documentos
- ‚úÖ Verifica√ß√µes de integridade: HasVerifiedDocuments, HasRequiredDocuments, HasPendingDocuments
- ‚úÖ Sistema de contadores por status (DocumentStatusCountDto)
- ‚úÖ Suporte a OCR data extraction (campo OcrData para dados extra√≠dos)
- ‚úÖ Rejection/Failure reasons para auditoria

**Arquitetura Implementada**:
```csharp
// Document: Aggregate Root
public sealed class Document : AggregateRoot<DocumentId>
{
    public Guid ProviderId { get; }
    public EDocumentType DocumentType { get; } 
    public string FileUrl { get; } // Blob name/key no Azure Storage
    public string FileName { get; }
    public EDocumentStatus Status { get; }
    public DateTime UploadedAt { get; }
    public DateTime? VerifiedAt { get; }
    public string? RejectionReason { get; }
    public string? OcrData { get; }
}
```

**API P√∫blica Implementada**:
```csharp
public interface IDocumentsModuleApi : IModuleApi
{
    Task<Result<ModuleDocumentDto?>> GetDocumentByIdAsync(Guid documentId, CancellationToken ct = default);
    Task<Result<IReadOnlyList<ModuleDocumentDto>>> GetProviderDocumentsAsync(Guid providerId, CancellationToken ct = default);
    Task<Result<ModuleDocumentStatusDto?>> GetDocumentStatusAsync(Guid documentId, CancellationToken ct = default);
    Task<Result<bool>> HasVerifiedDocumentsAsync(Guid providerId, CancellationToken ct = default);
    Task<Result<bool>> HasRequiredDocumentsAsync(Guid providerId, CancellationToken ct = default);
    Task<Result<DocumentStatusCountDto>> GetDocumentStatusCountAsync(Guid providerId, CancellationToken ct = default);
    Task<Result<bool>> HasPendingDocumentsAsync(Guid providerId, CancellationToken ct = default);
    Task<Result<bool>> HasRejectedDocumentsAsync(Guid providerId, CancellationToken ct = default);
}
```

**Pr√≥ximas Melhorias (Fase 2)**:
- üîÑ Background worker para verifica√ß√£o automatizada via OCR
- üîÑ Integra√ß√£o com APIs governamentais para valida√ß√£o
- üîÑ Sistema de scoring autom√°tico baseado em qualidade de documentos

---

### 1.4. ‚úÖ M√≥dulo Search & Discovery (Conclu√≠do)

**Status**: Implementado e em produ√ß√£o

**Funcionalidades Entregues**:
- ‚úÖ Busca geolocalizada com PostGIS nativo
- ‚úÖ Read model denormalizado otimizado (SearchableProvider)
- ‚úÖ Filtros por raio, servi√ßos, rating m√≠nimo e subscription tiers
- ‚úÖ Ranking multi-crit√©rio (tier ‚Üí rating ‚Üí dist√¢ncia)
- ‚úÖ Pagina√ß√£o server-side com contagem total
- ‚úÖ Queries espaciais nativas (ST_DWithin, ST_Distance)
- ‚úÖ Hybrid repository (EF Core + Dapper) para performance
- ‚úÖ Valida√ß√£o de raio n√£o-positivo (short-circuit)
- ‚úÖ CancellationToken support para queries longas
- ‚úÖ API p√∫blica (ISearchModuleApi)

**Arquitetura Implementada**:
```csharp
// SearchableProvider: Read Model
public sealed class SearchableProvider : AggregateRoot<SearchableProviderId>
{
    public Guid ProviderId { get; }
    public string Name { get; }
    public GeoPoint Location { get; } // Latitude, Longitude com PostGIS
    public decimal AverageRating { get; }
    public int TotalReviews { get; }
    public ESubscriptionTier SubscriptionTier { get; } // Free, Standard, Gold, Platinum
    public Guid[] ServiceIds { get; }
    public bool IsActive { get; }
    public string? Description { get; }
    public string? City { get; }
    public string? State { get; }
}
```

**API P√∫blica Implementada**:
```csharp
public interface ISearchModuleApi
{
    Task<Result<ModulePagedSearchResultDto>> SearchProvidersAsync(
        double latitude,
        double longitude,
        double radiusInKm,
        Guid[]? serviceIds = null,
        decimal? minRating = null,
        SubscriptionTier[]? subscriptionTiers = null,
        int pageNumber = 1,
        int pageSize = 20,
        CancellationToken cancellationToken = default);
}
```

**L√≥gica de Ranking Implementada**:
1. ‚úÖ Filtrar por raio usando `ST_DWithin` (√≠ndice GIST)
2. ‚úÖ Ordenar por tier de assinatura (Platinum > Gold > Standard > Free)
3. ‚úÖ Ordenar por avalia√ß√£o m√©dia (descendente)
4. ‚úÖ Ordenar por dist√¢ncia (crescente) como desempate

**Performance**:
- ‚úÖ Queries espaciais executadas no banco (n√£o in-memory)
- ‚úÖ √çndices GIST para geolocaliza√ß√£o
- ‚úÖ Pagina√ß√£o eficiente com OFFSET/LIMIT
- ‚úÖ Count query separada para total

**Pr√≥ximas Melhorias (Opcional)**:
- üîÑ Migra√ß√£o para Elasticsearch para maior escalabilidade (se necess√°rio)
- üîÑ Indexing worker consumindo integration events (atualmente manual)
- üîÑ Caching de resultados para queries frequentes

---

### 1.5. ‚úÖ M√≥dulo Location Management (Conclu√≠do)

**Status**: Implementado e testado

**Objetivo**: Abstrair funcionalidades de geolocaliza√ß√£o e lookup de CEP brasileiro.

**Funcionalidades Entregues**:
- ‚úÖ ValueObjects: Cep, Coordinates, Address com valida√ß√£o completa
- ‚úÖ Integra√ß√£o com APIs de CEP: ViaCEP, BrasilAPI, OpenCEP
- ‚úÖ Fallback chain autom√°tico (ViaCEP ‚Üí BrasilAPI ‚Üí OpenCEP)
- ‚úÖ Resili√™ncia HTTP via ServiceDefaults (retry, circuit breaker, timeout)
- ‚úÖ API p√∫blica (ILocationModuleApi) para comunica√ß√£o inter-m√≥dulos
- ‚úÖ Servi√ßo de geocoding (stub para implementa√ß√£o futura)
- ‚úÖ 52 testes unit√°rios passando (100% coverage em ValueObjects)

**Arquitetura Implementada**:
```csharp
// ValueObjects
public sealed class Cep // Valida e formata CEP brasileiro (12345-678)
public sealed class Coordinates // Latitude/Longitude com valida√ß√£o de limites
public sealed class Address // Endere√ßo completo com CEP, rua, bairro, cidade, UF

// API P√∫blica
public interface ILocationModuleApi : IModuleApi
{
    Task<Result<AddressDto>> GetAddressFromCepAsync(string cep, CancellationToken ct = default);
    Task<Result<CoordinatesDto>> GetCoordinatesFromAddressAsync(string address, CancellationToken ct = default);
}
```

**Servi√ßos Implementados**:
- `CepLookupService`: Implementa chain of responsibility com fallback entre provedores
- `ViaCepClient`, `BrasilApiCepClient`, `OpenCepClient`: Clients HTTP com resili√™ncia
- `GeocodingService`: Stub (TODO: integra√ß√£o com Nominatim ou Google Maps API)

**Pr√≥ximas Melhorias (Opcional)**:
- üîÑ Implementar GeocodingService com Nominatim (OpenStreetMap) ou Google Maps API
- üîÑ Adicionar caching Redis para reduzir chamadas √†s APIs externas (TTL: 24h para CEP, 7d para geocoding)
- üîÑ Integra√ß√£o com IBGE para lookup de munic√≠pios e estados

---

### 1.6. ‚úÖ M√≥dulo service_catalogs (Conclu√≠do)

**Status**: Implementado e funcional com testes completos

**Objetivo**: Gerenciar tipos de servi√ßos que prestadores podem oferecer atrav√©s de um cat√°logo admin-managed.

#### **Arquitetura Implementada**
- **Padr√£o**: DDD + CQRS com hierarquia de categorias
- **Schema**: `service_catalogs` (isolado)
- **Naming**: snake_case no banco, PascalCase no c√≥digo

#### **Entidades de Dom√≠nio Implementadas**
```csharp
// ServiceCategory: Aggregate Root
public sealed class ServiceCategory : AggregateRoot<ServiceCategoryId>
{
    public string Name { get; }
    public string? Description { get; }
    public bool IsActive { get; }
    public int DisplayOrder { get; }
    
    // Domain Events: Created, Updated, Activated, Deactivated
    // Business Rules: Nome √∫nico, valida√ß√µes de cria√ß√£o/atualiza√ß√£o
}

// Service: Aggregate Root
public sealed class Service : AggregateRoot<ServiceId>
{
    public ServiceCategoryId CategoryId { get; }
    public string Name { get; }
    public string? Description { get; }
    public bool IsActive { get; }
    public int DisplayOrder { get; }
    
    // Domain Events: Created, Updated, Activated, Deactivated, CategoryChanged
    // Business Rules: Nome √∫nico, categoria ativa, valida√ß√µes
}
```

#### **Camadas Implementadas**

**1. Domain Layer** ‚úÖ
- `ServiceCategoryId` e `ServiceId` (strongly-typed IDs)
- Agregados com l√≥gica de neg√≥cio completa
- 9 Domain Events (lifecycle completo)
- Reposit√≥rios: `IServiceCategoryRepository`, `IServiceRepository`
- Exception: `CatalogDomainException`

**2. Application Layer** ‚úÖ
- **DTOs**: ServiceCategoryDto, ServiceDto, ServiceListDto, ServiceCategoryWithCountDto
- **Commands** (11 total):
  - Categories: Create, Update, Activate, Deactivate, Delete
  - Services: Create, Update, ChangeCategory, Activate, Deactivate, Delete
- **Queries** (6 total):
  - Categories: GetById, GetAll, GetWithCount
  - Services: GetById, GetAll, GetByCategory
- **Handlers**: 11 Command Handlers + 6 Query Handlers
- **Module API**: `service_catalogsModuleApi` para comunica√ß√£o inter-m√≥dulos

**3. Infrastructure Layer** ‚úÖ
- `service_catalogsDbContext` com schema isolation (`service_catalogs`)
- EF Core Configurations (snake_case, √≠ndices otimizados)
- Repositories com SaveChangesAsync integrado
- DI registration com auto-migration support

**4. API Layer** ‚úÖ
- **Endpoints REST** usando Minimal APIs pattern:
  - `GET /api/v1/catalogs/categories` - Listar categorias
  - `GET /api/v1/catalogs/categories/{id}` - Buscar categoria
  - `POST /api/v1/catalogs/categories` - Criar categoria
  - `PUT /api/v1/catalogs/categories/{id}` - Atualizar categoria
  - `POST /api/v1/catalogs/categories/{id}/activate` - Ativar
  - `POST /api/v1/catalogs/categories/{id}/deactivate` - Desativar
  - `DELETE /api/v1/catalogs/categories/{id}` - Deletar
  - `GET /api/v1/catalogs/services` - Listar servi√ßos
  - `GET /api/v1/catalogs/services/{id}` - Buscar servi√ßo
  - `GET /api/v1/catalogs/services/category/{categoryId}` - Por categoria
  - `POST /api/v1/catalogs/services` - Criar servi√ßo
  - `PUT /api/v1/catalogs/services/{id}` - Atualizar servi√ßo
  - `POST /api/v1/catalogs/services/{id}/change-category` - Mudar categoria
  - `POST /api/v1/catalogs/services/{id}/activate` - Ativar
  - `POST /api/v1/catalogs/services/{id}/deactivate` - Desativar
  - `DELETE /api/v1/catalogs/services/{id}` - Deletar
- **Autoriza√ß√£o**: Todos endpoints requerem role Admin
- **Versionamento**: Sistema unificado via BaseEndpoint

**5. Shared.Contracts** ‚úÖ
- `Iservice_catalogsModuleApi` - Interface p√∫blica
- DTOs: ModuleServiceCategoryDto, ModuleServiceDto, ModuleServiceListDto, ModuleServiceValidationResultDto

#### **API P√∫blica Implementada**
```csharp
public interface Iservice_catalogsModuleApi : IModuleApi
{
    Task<Result<ModuleServiceCategoryDto?>> GetServiceCategoryByIdAsync(Guid categoryId, CancellationToken ct = default);
    Task<Result<IReadOnlyList<ModuleServiceCategoryDto>>> GetAllServiceCategoriesAsync(bool activeOnly = true, CancellationToken ct = default);
    Task<Result<ModuleServiceDto?>> GetServiceByIdAsync(Guid serviceId, CancellationToken ct = default);
    Task<Result<IReadOnlyList<ModuleServiceListDto>>> GetAllServicesAsync(bool activeOnly = true, CancellationToken ct = default);
    Task<Result<IReadOnlyList<ModuleServiceDto>>> GetServicesByCategoryAsync(Guid categoryId, bool activeOnly = true, CancellationToken ct = default);
    Task<Result<bool>> IsServiceActiveAsync(Guid serviceId, CancellationToken ct = default);
    Task<Result<ModuleServiceValidationResultDto>> ValidateServicesAsync(Guid[] serviceIds, CancellationToken ct = default);
}
```

#### **Status de Compila√ß√£o**
- ‚úÖ **Domain**: BUILD SUCCEEDED (3 warnings XML documentation)
- ‚úÖ **Application**: BUILD SUCCEEDED (18 warnings SonarLint - n√£o cr√≠ticos)
- ‚úÖ **Infrastructure**: BUILD SUCCEEDED
- ‚úÖ **API**: BUILD SUCCEEDED
- ‚úÖ **Adicionado √† Solution**: 4 projetos integrados

#### **Integra√ß√£o com Outros M√≥dulos**
- **Providers Module** (Planejado): Adicionar ProviderServices linking table
- **Search Module** (Planejado): Denormalizar services nos SearchableProvider
- **Admin Portal**: Endpoints prontos para gest√£o de cat√°logo

#### **Pr√≥ximos Passos (P√≥s-MVP)**
1. **Testes**: Implementar unit tests e integration tests
2. **Migrations**: Criar e aplicar migration inicial do schema `service_catalogs`
3. **Bootstrap**: Integrar no Program.cs e AppHost
4. **Provider Integration**: Estender Providers para suportar ProviderServices
5. **Admin UI**: Interface para gest√£o de cat√°logo
6. **Seeders**: Popular cat√°logo inicial com servi√ßos comuns

#### **Considera√ß√µes T√©cnicas**
- **SaveChangesAsync**: Integrado nos reposit√≥rios (padr√£o do projeto)
- **Valida√ß√µes**: Nome √∫nico por categoria/servi√ßo, categoria ativa para criar servi√ßo
- **Soft Delete**: N√£o implementado (hard delete com valida√ß√£o de depend√™ncias)
- **Cascata**: DeleteServiceCategory valida se h√° servi√ßos vinculados

#### **Schema do Banco de Dados**
```sql
-- Schema: service_catalogs
CREATE TABLE service_catalogs.service_categories (
    id UUID PRIMARY KEY,
    name VARCHAR(200) NOT NULL UNIQUE,
    description TEXT,
    is_active BOOLEAN NOT NULL DEFAULT TRUE,
    display_order INT NOT NULL DEFAULT 0,
    created_at TIMESTAMP NOT NULL,
    updated_at TIMESTAMP
);

CREATE TABLE service_catalogs.services (
    id UUID PRIMARY KEY,
    category_id UUID NOT NULL REFERENCES service_catalogs.service_categories(id),
    name VARCHAR(200) NOT NULL UNIQUE,
    description TEXT,
    is_active BOOLEAN NOT NULL DEFAULT TRUE,
    display_order INT NOT NULL DEFAULT 0,
    created_at TIMESTAMP NOT NULL,
    updated_at TIMESTAMP
);

CREATE INDEX idx_services_category_id ON service_catalogs.services(category_id);
CREATE INDEX idx_services_is_active ON service_catalogs.services(is_active);
CREATE INDEX idx_service_categories_is_active ON service_catalogs.service_categories(is_active);
```

---

## üéØ Fase 2: Qualidade e Monetiza√ß√£o

### Objetivo
Introduzir sistema de avalia√ß√µes para ranking, modelo de assinaturas premium via Stripe, e verifica√ß√£o automatizada de documentos.

### 2.1. ‚≠ê M√≥dulo Reviews & Ratings (Planejado)

**Objetivo**: Permitir que clientes avaliem prestadores, influenciando ranking de busca.

#### **Arquitetura Proposta**
- **Padr√£o**: Simple layered architecture
- **Agrega√ß√£o**: C√°lculo de `AverageRating` via integration events (n√£o real-time)

#### **Entidades de Dom√≠nio**
```csharp
// Review: Aggregate Root
public class Review
{
    public Guid ReviewId { get; }
    public Guid ProviderId { get; }
    public Guid CustomerId { get; }
    public int Rating { get; } // 1-5
    public string? Comment { get; }
    public DateTime CreatedAt { get; }
    public bool IsFlagged { get; } // Para modera√ß√£o
}

// ProviderRating: Aggregate (ou parte do read model)
public class ProviderRating
{
    public Guid ProviderId { get; }
    public decimal AverageRating { get; }
    public int TotalReviews { get; }
    public DateTime LastUpdated { get; }
}
```

#### **API P√∫blica (IReviewsModuleApi)**
```csharp
public interface IReviewsModuleApi : IModuleApi
{
    Task<Result> SubmitReviewAsync(SubmitReviewRequest request, CancellationToken ct = default);
    Task<Result<PagedList<ReviewDto>>> GetReviewsForProviderAsync(
        Guid providerId, 
        int page, 
        int pageSize, 
        CancellationToken ct = default);
    Task<Result> FlagReviewAsync(Guid reviewId, string reason, CancellationToken ct = default);
}
```

#### **Implementa√ß√£o**
1. **Schema**: Criar `meajudaai_reviews` com `reviews`, `provider_ratings`
2. **Submit Endpoint**: Validar que cliente pode avaliar (servi√ßo contratado?)
3. **Rating Calculation**: Publicar `ReviewAddedIntegrationEvent` ‚Üí Search module atualiza `AverageRating`
4. **Modera√ß√£o**: Sistema de flag para reviews inapropriados
5. **Testes**: Unit tests para c√°lculo de m√©dia + integration tests para submission

---

### 2.2. üí≥ M√≥dulo Payments & Billing (Planejado)

**Objetivo**: Gerenciar assinaturas de prestadores via Stripe (Free, Standard, Gold, Platinum).

#### **Arquitetura Proposta**
- **Padr√£o**: Anti-Corruption Layer (ACL) sobre Stripe API
- **Isolamento**: L√≥gica de dom√≠nio protegida de mudan√ßas na Stripe

#### **Entidades de Dom√≠nio**
```csharp
// Subscription: Aggregate Root
public class Subscription
{
    public Guid SubscriptionId { get; }
    public Guid ProviderId { get; }
    public string StripeSubscriptionId { get; }
    public ESubscriptionPlan Plan { get; } // Free, Standard, Gold, Platinum
    public ESubscriptionStatus Status { get; } // Active, Canceled, PastDue
    public DateTime StartDate { get; }
    public DateTime? EndDate { get; }
}

// BillingAttempt: Entity
public class BillingAttempt
{
    public Guid AttemptId { get; }
    public Guid SubscriptionId { get; }
    public decimal Amount { get; }
    public bool IsSuccessful { get; }
    public DateTime AttemptedAt { get; }
}
```

#### **API P√∫blica (IBillingModuleApi)**
```csharp
public interface IBillingModuleApi : IModuleApi
{
    Task<Result<string>> CreateCheckoutSessionAsync(
        CreateCheckoutRequest request, 
        CancellationToken ct = default);
    Task<Result<SubscriptionDto>> GetSubscriptionForProviderAsync(
        Guid providerId, 
        CancellationToken ct = default);
}
```

#### **Implementa√ß√£o**
1. **Stripe Setup**: Configurar produtos e pricing plans no dashboard
2. **Webhook Endpoint**: Receber eventos Stripe (`checkout.session.completed`, `invoice.payment_succeeded`, `customer.subscription.deleted`)
3. **Event Handlers**: Atualizar status de `Subscription` baseado em eventos
4. **Checkout Session**: Gerar URL de checkout para frontend
5. **Integration Events**: Publicar `SubscriptionTierChangedIntegrationEvent` ‚Üí Search module atualiza ranking
6. **Testes**: Integration tests com mock events da Stripe testing library

---

### 2.3. ü§ñ Documents - Verifica√ß√£o Automatizada (Planejado - Fase 2)

**Objetivo**: Automatizar verifica√ß√£o de documentos via OCR e APIs governamentais.

**Funcionalidades Planejadas**:
- **OCR Inteligente**: Azure AI Vision para extrair texto de documentos
- **Valida√ß√£o de Dados**: Cross-check com dados fornecidos pelo prestador
- **Background Checks**: Integra√ß√£o com APIs de antecedentes criminais
- **Scoring Autom√°tico**: Sistema de pontua√ß√£o baseado em qualidade de documentos

**Background Jobs**:
1. **DocumentUploadedHandler**: Trigger OCR processing
2. **OcrCompletedHandler**: Validar campos extra√≠dos
3. **VerificationScheduler**: Agendar verifica√ß√µes peri√≥dicas

**Nota**: Infraestrutura b√°sica j√° existe (campo OcrData, estados de verifica√ß√£o), falta implementar workers e integra√ß√µes.

---

## üöÄ Fase 3: Experi√™ncia e Engajamento (Post-MVP)

### Objetivo
Melhorar experi√™ncia do usu√°rio com agendamentos, comunica√ß√µes centralizadas e analytics avan√ßado.

### 3.1. üìÖ M√≥dulo Service Requests & Booking (Planejado)

**Objetivo**: Permitir que clientes solicitem servi√ßos e agendem hor√°rios com prestadores.

#### **Funcionalidades**
- **Solicita√ß√£o de Servi√ßo**: Cliente descreve necessidade e localiza√ß√£o
- **Matching**: Sistema sugere prestadores compat√≠veis
- **Agendamento**: Calend√°rio integrado com disponibilidade de prestador
- **Notifica√ß√µes**: Lembretes autom√°ticos via Communications module

---

### 3.2. üìß M√≥dulo Communications (Planejado)

**Objetivo**: Centralizar e orquestrar todas as comunica√ß√µes da plataforma (email, SMS, push).

#### **Arquitetura Proposta**
- **Padr√£o**: Orchestrator Pattern
- **Canais**: Email (SendGrid/Mailgun), SMS (Twilio), Push (Firebase)

#### **API P√∫blica (ICommunicationsModuleApi)**
```csharp
public interface ICommunicationsModuleApi : IModuleApi
{
    Task<Result> SendEmailAsync(EmailRequest request, CancellationToken ct = default);
    Task<Result> SendSmsAsync(SmsRequest request, CancellationToken ct = default);
    Task<Result> SendPushNotificationAsync(PushRequest request, CancellationToken ct = default);
}
```

#### **Event Handlers**
- `UserRegisteredIntegrationEvent` ‚Üí Email de boas-vindas
- `ProviderVerificationFailedIntegrationEvent` ‚Üí Notifica√ß√£o de rejei√ß√£o
- `BookingConfirmedIntegrationEvent` ‚Üí Lembrete de agendamento

#### **Implementa√ß√£o**
1. **Channel Handlers**: Implementar `IEmailService`, `ISmsService`, `IPushService`
2. **Template Engine**: Sistema de templates para mensagens (Razor, Handlebars)
3. **Queue Processing**: Background worker para processar fila de mensagens
4. **Retry Logic**: Polly para retry com backoff exponencial
5. **Testes**: Unit tests para handlers + integration tests com mock services

---

### 3.3. üìä M√≥dulo Analytics & Reporting (Planejado)

**Objetivo**: Capturar, processar e visualizar dados de neg√≥cio e operacionais.

#### **Arquitetura Proposta**
- **Padr√£o**: CQRS + Event Sourcing (para audit)
- **Metrics**: Fa√ßade sobre OpenTelemetry/Aspire
- **Audit**: Immutable event log de todas as atividades
- **Reporting**: Denormalized read models para queries r√°pidos

#### **API P√∫blica (IAnalyticsModuleApi)**
```csharp
public interface IAnalyticsModuleApi : IModuleApi
{
    Task<Result<ReportDto>> GetReportAsync(ReportQuery query, CancellationToken ct = default);
    Task<Result<PagedList<AuditLogEntryDto>>> GetAuditHistoryAsync(
        AuditLogQuery query, 
        CancellationToken ct = default);
}
```

#### **Database Views**
```sql
-- vw_provider_summary: Vis√£o hol√≠stica de cada prestador
CREATE VIEW meajudaai_analytics.vw_provider_summary AS
SELECT 
    p.provider_id,
    p.name,
    p.status,
    p.join_date,
    s.subscription_tier,
    pr.average_rating,
    pr.total_reviews
FROM meajudaai_providers.providers p
LEFT JOIN meajudaai_billing.subscriptions s ON p.provider_id = s.provider_id
LEFT JOIN meajudaai_reviews.provider_ratings pr ON p.provider_id = pr.provider_id;

-- vw_financial_transactions: Consolida√ß√£o de eventos financeiros
CREATE VIEW meajudaai_analytics.vw_financial_transactions AS
SELECT 
    ba.attempt_id AS transaction_id,
    s.provider_id,
    ba.amount,
    s.plan,
    ba.is_successful AS status,
    ba.attempted_at AS transaction_date
FROM meajudaai_billing.billing_attempts ba
JOIN meajudaai_billing.subscriptions s ON ba.subscription_id = s.subscription_id;

-- vw_audit_log_enriched: Audit log leg√≠vel
CREATE VIEW meajudaai_analytics.vw_audit_log_enriched AS
SELECT 
    al.log_id,
    al.timestamp,
    al.event_name,
    al.actor_id,
    COALESCE(u.full_name, p.name) AS actor_name,
    al.entity_id,
    al.details_json
FROM meajudaai_analytics.audit_log al
LEFT JOIN meajudaai_users.users u ON al.actor_id = u.user_id
LEFT JOIN meajudaai_providers.providers p ON al.actor_id = p.provider_id;
```

#### **Implementa√ß√£o**
1. **Schema**: Criar `meajudaai_analytics` com `audit_log`, reporting tables
2. **Event Handlers**: Consumir todos integration events relevantes
3. **Metrics Integration**: Expor m√©tricas customizadas via OpenTelemetry
4. **Reporting API**: Endpoints otimizados para leitura de relat√≥rios
5. **Dashboards**: Integra√ß√£o com Aspire Dashboard e Grafana
6. **Testes**: Integration tests para event handlers + performance tests para reporting

---

## üé® Frontend Applications

### üì± Stack Tecnol√≥gico
- **Framework**: React + TypeScript (Vite)
- **UI Library**: Material-UI (MUI)
- **State Management**: Zustand
- **API Client**: Axios com wrapper customizado
- **Auth**: oidc-client-ts (integra√ß√£o com Keycloak)

### üóÇÔ∏è Estrutura de Projetos
```text
web/
‚îú‚îÄ‚îÄ admin-portal/       # Portal administrativo
‚îú‚îÄ‚îÄ customer-app/       # App para clientes (futuro)
‚îú‚îÄ‚îÄ provider-app/       # App para prestadores (futuro)
‚îî‚îÄ‚îÄ shared/            # Componentes compartilhados
```

### üîê Autentica√ß√£o
- **Protocolo**: OpenID Connect (OIDC)
- **Identity Provider**: Keycloak
- **Token Management**: Autom√°tico via oidc-client-ts
- **Storage**: Secure token storage (sessionStorage/localStorage com encryption)

### üéØ Prioridades de Implementa√ß√£o
1. **Admin Portal** (Fase 1)
   - Gest√£o de usu√°rios e prestadores
   - Modera√ß√£o de reviews
   - Dashboard de m√©tricas b√°sico
   - Gest√£o de cat√°logo de servi√ßos

2. **Customer Profile** (Fase 1)
   - Edi√ß√£o de perfil
   - Hist√≥rico de solicita√ß√µes
   - Gest√£o de reviews escritos

3. **Provider Portal** (Fase 2)
   - Dashboard anal√≠tico
   - Gest√£o de documentos
   - Calend√°rio de disponibilidade
   - Gest√£o de assinatura

---

## üéØ Funcionalidades Priorit√°rias Recomendadas

### üõ°Ô∏è Admin Portal (Alta Prioridade)
**Por qu√™**: Opera√ß√µes da plataforma s√£o imposs√≠veis sem back-office.

**Funcionalidades Core**:
- **User & Provider Management**: Visualizar, suspender, verificar manualmente
- **service_catalogs Management**: Aprovar/rejeitar servi√ßos sugeridos
- **Review Moderation**: Lidar com reviews sinalizados
- **Dashboard**: M√©tricas-chave do m√≥dulo Analytics

**Implementa√ß√£o**: App Blazor ou React separado consumindo mesma API (endpoints admin-only)

---

### üë§ Customer Profile Management (Alta Prioridade)
**Por qu√™**: Plano atual √© muito focado em prestadores; clientes tamb√©m precisam de gest√£o de perfil.

**Funcionalidades Core**:
- Editar informa√ß√µes b√°sicas (nome, foto)
- Ver hist√≥rico de prestadores contatados
- Gerenciar reviews escritos
- Prefer√™ncias de notifica√ß√µes

**Implementa√ß√£o**: Enhancement ao m√≥dulo Users existente

---

### ‚öñÔ∏è Dispute Resolution System (M√©dia Prioridade)
**Por qu√™**: Mesmo sem pagamentos in-app, disputas podem ocorrer (reviews injustos, m√° conduta).

**Funcionalidades Core**:
- Bot√£o "Reportar" em perfis de prestadores e reviews
- Formul√°rio para descrever problema
- Fila no Admin Portal para moderadores

**Implementa√ß√£o**: Novo m√≥dulo pequeno ou extens√£o do m√≥dulo Reviews

---

## üìä M√©tricas de Sucesso

### üìà M√©tricas de Produto
- **Crescimento de usu√°rios**: 20% ao m√™s
- **Reten√ß√£o de prestadores**: 85%
- **Satisfa√ß√£o m√©dia**: 4.5+ estrelas
- **Taxa de convers√£o (Free ‚Üí Paid)**: 15%

### ‚ö° M√©tricas T√©cnicas (SLOs)

#### **Tiered Performance Targets**

| Categoria | Tempo Alvo | Exemplo |
|-----------|------------|---------|
| **Consultas Simples** | <200ms | Busca por ID, dados em cache |
| **Consultas M√©dias** | <500ms | Listagens com filtros b√°sicos |
| **Consultas Complexas** | <1000ms | Busca cross-module, agrega√ß√µes |
| **Consultas Anal√≠ticas** | <3000ms | Relat√≥rios, dashboards |

#### **Baseline de Desempenho**
- **Assumindo**: Cache distribu√≠do configurado, √≠ndices otimizados
- **Revis√£o**: Ajustes trimestrais baseados em m√©tricas reais (P50, P95, P99)
- **Monitoramento**: OpenTelemetry + Aspire Dashboard

#### **Outros SLOs**
- **Disponibilidade**: 99.9% uptime
- **Seguran√ßa**: Zero vulnerabilidades cr√≠ticas
- **Cobertura de Testes**: >80% para c√≥digo cr√≠tico

---

## üîÑ Processo de Gest√£o do Roadmap

### üìÖ Revis√£o Trimestral
- Avalia√ß√£o de progresso contra milestones
- Ajuste de prioridades baseado em m√©tricas
- An√°lise de feedback de usu√°rios e prestadores

### üí¨ Feedback Cont√≠nuo
- **Input da comunidade**: Surveys, suporte, analytics
- **Feedback de prestadores**: Portal dedicado para sugest√µes
- **Necessidades de neg√≥cio**: Alinhamento com stakeholders

### üéØ Crit√©rios de Prioriza√ß√£o
1. **Impacto no MVP**: Funcionalidade √© cr√≠tica para lan√ßamento?
2. **Esfor√ßo de Implementa√ß√£o**: Complexidade t√©cnica e tempo estimado
3. **Depend√™ncias**: Quais m√≥dulos dependem desta funcionalidade?
4. **Valor para Usu√°rio**: Feedback qualitativo e quantitativo

---

## üìã Sum√°rio Executivo de Prioridades

### ‚úÖ **Alta Prioridade (Pr√≥ximos 6 meses - Fase 1)**
1. ‚úÖ M√≥dulo Users (Conclu√≠do)
2. ‚úÖ M√≥dulo Providers (Conclu√≠do)
3. ‚úÖ M√≥dulo Documents (Conclu√≠do)
4. ‚úÖ M√≥dulo Search & Discovery (Conclu√≠do)
5. üìã M√≥dulo Location - CEP lookup e geocoding
6. üìã M√≥dulo service_catalogs - Cat√°logo admin-managed de categorias e servi√ßos
7. üìã Admin Portal - Gest√£o b√°sica
8. üìã Customer Profile - Gest√£o de perfil

### üéØ **M√©dia Prioridade (6-12 meses - Fase 2)**
1. ‚≠ê M√≥dulo Reviews & Ratings
2. üí≥ M√≥dulo Payments & Billing (Stripe)
3. ü§ñ Documents - Verifica√ß√£o automatizada (OCR + Background checks)
4. üîÑ Search - Indexing worker para integration events
5. üìä Analytics - M√©tricas b√°sicas
6. üìß Communications - Email notifications
7. üõ°Ô∏è Dispute Resolution System

### üîÆ **Baixa Prioridade (12+ meses - Fase 3)**
1. üìÖ Service Requests & Booking
2. üì± Mobile Apps (iOS/Android nativo)
3. üß† Recomenda√ß√µes com ML
4. üéÆ Gamifica√ß√£o avan√ßada
5. üí¨ Chat interno
6. üåê Internacionaliza√ß√£o

---

## üìö Refer√™ncias e Recursos

### üìñ Documenta√ß√£o Relacionada
- **Arquitetura**: [`docs/architecture.md`](./architecture.md) - Princ√≠pios e padr√µes arquiteturais
- **Desenvolvimento**: [`docs/development.md`](./development.md) - Guia de setup e workflow
- **Autentica√ß√£o**: [`docs/authentication_and_authorization.md`](./authentication_and_authorization.md) - Keycloak e OIDC
- **CI/CD**: [`docs/ci_cd.md`](./ci_cd.md) - Pipeline e deployment

### üîß Ferramentas e Tecnologias
- **.NET 9.0** - Runtime principal
- **PostgreSQL + PostGIS** - Database com suporte geoespacial
- **Keycloak** - Identity & Access Management
- **Stripe** - Payment processing
- **Azure Blob Storage** - Document storage
- **OpenTelemetry + Aspire** - Observability

---

*üìÖ √öltima atualiza√ß√£o: Novembro 2025*  
*üîÑ Roadmap em constante evolu√ß√£o baseado em feedback, m√©tricas e aprendizados*
