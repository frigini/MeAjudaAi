@using MeAjudaAi.Web.Admin.Services
@using Microsoft.JSInterop
@implements IDisposable
@inject IJSRuntime JS

@* ARIA live region for screen reader announcements *@
<div id="live-region" 
     class="visually-hidden" 
     role="status" 
     aria-live="polite" 
     aria-atomic="true">
    @_currentAnnouncement
</div>

@code {
    private string _currentAnnouncement = string.Empty;
    private System.Timers.Timer? _clearTimer;

    protected override void OnInitialized()
    {
        LiveRegionService.OnAnnouncement += HandleAnnouncement;
    }

    private void HandleAnnouncement(string message)
    {
        _currentAnnouncement = message;
        StateHasChanged();

        // Clear announcement after 5 seconds to prevent stale content
        _clearTimer?.Dispose();
        _clearTimer = new System.Timers.Timer(5000);
        _clearTimer.Elapsed += (sender, e) =>
        {
            _currentAnnouncement = string.Empty;
            InvokeAsync(StateHasChanged);
            _clearTimer?.Dispose();
        };
        _clearTimer.Start();
    }

    public void Dispose()
    {
        LiveRegionService.OnAnnouncement -= HandleAnnouncement;
        _clearTimer?.Dispose();
    }
}

<style>
    /* Visually hidden but accessible to screen readers */
    .visually-hidden {
        position: absolute;
        width: 1px;
        height: 1px;
        margin: -1px;
        padding: 0;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
    }
</style>
